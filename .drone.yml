---
clone:
  depth: 1
kind: pipeline
name: windows amd64 build
platform:
  os: windows
pull: always
steps:
- commands:
  - ci/scripts/build.ps1
  - ci/scripts/package.ps1
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-builder
  name: build
  when:
    event:
    - push
- commands:
  - ci/scripts/build.ps1
  - ci/scripts/package.ps1
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-builder
  name: release
  when:
    event:
    - tag
- commands:
  - cat LICENSE > license.dat
  - cat license.dat
  environment:
    LICENSE:
      from_secret: advancedinstaller_license
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-builder
  name: license installer
  when:
    event:
    - push
    - tag
    - custom
- commands:
  - ./ci/scripts/publish.ps1 windows windows amd64 100.0.0+${DRONE_COMMIT_SHA:0:8}
    ${DRONE_BUILD_EVENT}
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-builder
  name: copy build
  volumes: []
  when:
    event:
    - push
- commands:
  - ./ci/scripts/publish.ps1 windows windows amd64 ${DRONE_TAG} ${DRONE_BUILD_EVENT}
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-builder
  name: copy relase
  volumes: []
  when:
    event:
    - tag
trigger:
  event:
  - push
  - tag
  - custom
type: docker
volumes: []
---
clone:
  depth: 1
depends_on:
- windows amd64 build
kind: pipeline
name: windows index
platform:
  os: windows
pull: always
steps:
- commands:
  - Get-ChildItem -Recurse windows
  environment:
    GPG_PRIVATE_KEY:
      from_secret: gpg-private-key
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/msi-builder
  name: index build
  volumes: []
  when:
    event:
    - push
- commands:
  - Get-ChildItem -Recurse windows
  environment:
    GPG_PRIVATE_KEY:
      from_secret: gpg-private-key
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/msi-builder
  name: index release
  volumes: []
  when:
    event:
    - tag
trigger:
  event:
  - push
  - tag
  - custom
type: docker
volumes: []
---
clone:
  depth: 1
depends_on:
- windows index
kind: pipeline
name: windows amd64 test
platform:
  os: windows
pull: always
steps:
- commands:
  - ci/scripts/testpackage.ps1 100.0.0+${DRONE_COMMIT_SHA:0:8}
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-tester
  name: test build
  volumes: []
  when:
    event:
    - push
- commands:
  - ci/scripts/testpackage.ps1 ${DRONE_TAG}
  image: 084037375216.dkr.ecr.us-east-2.amazonaws.com/windows-tester
  name: test release
  volumes: []
  when:
    event:
    - tag
trigger:
  event:
  - push
  - tag
  - custom
type: docker
volumes: []
---
kind: signature
hmac: f581bf94cf753699e8dec3477aeef4dffe073cbffb52f4741e341394facac1c3

...
